# 单点登录


### SSO 与传统身份验证的区别

1. **一对一身份验证**：
   - 传统的身份验证通常是每个 web 应用程序（或微服务）都有自己的身份验证机制。用户在一个应用中登录后，系统会创建一个 session，并在该应用的后台管理用户的授权与验证。
   - 每个服务独立管理其用户身份和权限。

2. **单点登录（SSO）**：
   - 在 SSO 方案中，用户只需在一个统一的身份验证服务器（SSO）上登录。这个 SSO 负责处理用户的身份验证，并生成相应的令牌（如 JWT）或 session。
   - 所有其他应用程序（如 A、B）通过 SSO 进行认证和授权，而不是自己处理用户身份。

### SSO 的交互流程

- **前端与 SSO 交互**：
  - 用户在前端（浏览器）通过 SSO 登录，这个过程包括用户输入凭证、身份验证和获取令牌的过程。
  
- **SSO 与后端交互**：
  - 当用户访问另一个需要身份验证的应用（如 B）时，B 会重定向用户到 SSO。
  - SSO 会根据前端传递的令牌（通常是 cookie 或者 URL 参数）来验证用户的身份。验证通过后，SSO 可以生成新的令牌，或者直接返回给 B。

### Token 和 Cookie 传递

- 当用户在 A 应用中登录后，SSO 生成的令牌会存储在浏览器的 cookie 中。
- 当用户访问 B 应用时，B 应该能够通过重定向方式携带 cookie，确保 SSO 能够识别出之前的用户会话。
- 如果 SSO 和 B 应用部署在同源下，浏览器会自动传递相应的 cookie。

### SameSite Cookie 属性

- **SameSite Cookie** 是用来控制浏览器是否在跨站请求中发送 cookie 的属性，主要用于防止 CSRF 攻击。
- 如果您的 SSO 和各个应用都在同一个域名下（同源），可以考虑将 cookie 设置为 `SameSite=Lax` 或 `SameSite=None`，以确保跨应用间能够正常传递。
- 如果应用部署在不同的子域（如 `appA.example.com` 和 `appB.example.com`），需要将 cookie 设置为 `SameSite=None; Secure`，以便跨站请求能够正常传递，同时保证 cookie 的安全性（需要使用 HTTPS）。

### 结论

- SSO 集中管理身份验证，简化了多个服务之间的用户身份管理。
- 确保在跳转到 SSO 时，能够携带有效的 cookie 或令牌进行用户验证。
- 配置 SameSite 属性以适应不同的部署环境，从而保证安全和功能正常。

这样的设计使得用户在一个应用中登录后，能够无缝访问其他所有相关应用，而无需重复登录。