## linux 系统中的 cgroup

Linux 的 cgroup（控制组）是一个 Linux 内核特性，用于限制、记录、隔离进程组使用的物理资源（如 CPU、内存、磁盘 I/O 等）。cgroup 允许系统管理员精细地管理和监控系统资源的分配，以及控制进程的运行环境，提高系统的稳定性和性能。

### 主要特性和用途

- **资源限制**：可以限制进程组可以使用的资源量，比如 CPU 时间、系统内存、网络带宽或磁盘 I/O 的量。
- **优先级分配**：可以控制不同进程组资源使用的优先级，确保关键任务能获得足够的资源。
- **资源监控**：可以监控进程组使用的资源量，帮助系统管理员理解系统的运行状态。
- **进程隔离**：可以将不同的进程组隔离开，使它们不能相互干扰，提高系统的安全性。
- **任务控制**：可以对进程组执行暂停、恢复等操作。

### 实现方式

cgroup 通过一个虚拟文件系统（通常挂载在 `/sys/fs/cgroup` 下）提供用户空间和内核空间的交互接口。系统管理员和用户可以通过修改这些文件来改变 cgroup 的行为。

### 应用场景

- **容器技术**：Docker、Kubernetes 等容器技术广泛使用 cgroup 来限制和隔离容器内的资源使用，保证容器应用的资源分配和隔离。
- **系统资源管理**：在多用户或多任务的系统中，通过 cgroup 对不同的服务或用户组进行资源的细粒度管理，确保系统资源的合理分配和使用。
- **性能调优**：通过限制和调整进程组的资源使用，帮助改善系统的整体性能或确保关键应用的性能需求。

cgroup 是 Linux 系统管理和容器化技术中的核心机制，通过精确控制和分配系统资源，它在现代操作系统和云计算环境中发挥着重要作用。

### 对比 Windows 平台
Windows 平台使用的技术与 Linux 的 cgroups 类似的是“作业对象”(Job Objects)。在 Windows 中，作业对象允许将一组进程作为单元进行管理。例如，可以限制工作集大小、进程优先级或终止与作业相关联的所有进程。这为 Windows 提供了一种类似于 cgroups 的资源管理和限制机制。

另外，Windows 还引入了“处理器组”(Processor Groups)的概念，以支持在单台计算机上使用超过 64 个逻辑处理器。这通过将处理器分组来实现，其中每个组最多包含 64 个逻辑处理器，并作为单个调度实体处理。这主要用于优化系统性能和提高资源利用效率

## 通俗解释

电脑是一家餐厅，运行在这台电脑上的每个程序（比如浏览器、文档编辑器、游戏等）都是这家餐厅里的顾客。餐厅的资源（比如食物、饮料等）在这里对应于电脑的资源，如 CPU 时间、内存、磁盘空间等。

没有 cgroup 的情况下，所有顾客（程序）都可以随意点任何他们想要的食物（占用资源），这可能会导致一些贪心的顾客把大部分食物都吃光了，留下其他顾客饿着。

引入 cgroup 后，餐厅管理者（系统管理员）可以创建不同的“控制组”，比如为“儿童区”、“VIP 区”和“普通区”分别设立控制组。然后，餐厅管理者可以规定，“儿童区”的顾客每人只能点最多两份甜点，“VIP 区”的顾客可以不限量点酒水，而“普通区”则有总体的食物和饮料限制。在电脑资源管理中，这相当于限制不同程序或进程组使用特定数量的 CPU 时间、内存等资源。

### 具体示例

假设有一个运行很多服务的 Linux 服务器，这些服务包括网页服务器、数据库和文件共享服务。你发现，当数据库非常繁忙时，它会消耗大量 CPU 资源，导致网页服务器响应变慢。为了解决这个问题，你可以使用 cgroup 将数据库和网页服务器分配到不同的控制组，并为每个组设置 CPU 使用率的限制。这样即使数据库非常忙，也不会影响到网页服务器的性能。

在 Linux 上，你可以通过以下步骤来创建和管理 cgroup：

1. **创建控制组**：首先，你需要创建一个新的控制组，为它指定一个名字，比如“webserver”和“database”。

2. **设置资源限制**：然后，你可以为每个控制组设置资源限制，比如 CPU 使用率、内存使用量等。例如，你可以限制“database”控制组最多只能使用 50% 的 CPU 资源。

3. **添加进程到控制组**：最后，你需要将运行中的服务进程添加到相应的控制组中。这样，这些进程就会受到你设置的资源限制的约束。

通过上述步骤，即使在资源竞争激烈的情况下，你也能保证关键服务（如网页服务器）的性能不会受到影响。